#include "ginsthook.h"
#include <memory.h>

uint64_t oginst;

game_instance* g_instance;
void* ginstHook(game_instance* instance) {
	g_instance = instance;
	return PLH::FnCast(oginst, ginstHook)(instance);
}

auto ginsthook::apply() -> bool {
    uintptr_t fp = (uintptr_t)memory::FindSig("40 ?? 48 83 EC ?? 48 8B ?? ?? ?? ?? ?? 48 85 ?? 75 ?? B9 ?? ?? ?? ?? E8 ?? ?? ?? ?? 48 8B ?? 48 89 ?? ?? ?? 48 85 ?? 74 ?? 33 D2 41 B8 ?? ?? ?? ?? 48 8B ?? E8 ?? ?? ?? ?? 48 8B ?? E8 ?? ?? ?? ?? 90 48 89 ?? ?? ?? ?? ?? 48 8B ?? 48 83 C4 ?? 5B E9 ?? ?? ?? ?? CC CC CC CC CC CC CC CC CC CC 4C 8B");

	this->create_detour(fp, (uint64_t)&ginstHook, (uint64_t*)&oginst);
	if(this->get_detour()->hook()) {
		return true;
	}
	return false;
}

auto ginsthook::remove() -> bool {
	return this->get_detour()->unHook();
}