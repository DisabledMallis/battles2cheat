#include "hud_destruct.h"
#include <game_hud.h>
#include <memory.h>

uint64_t ohuddestfunc;
extern CGameHudScreen* p_gamehud;
void hudhook_destructor(uintptr_t game_hud) {
	p_gamehud = nullptr;
	PLH::FnCast(ohuddestfunc, hudhook_destructor)(game_hud);
}

auto hud_destructor::apply() -> bool {
	uintptr_t fp = (uintptr_t)memory::FindSig("48 89 ?? ?? ?? 57 48 83 EC ?? 8B DA 48 8B ?? E8 ?? ?? ?? ?? F6 C3 ?? 74 ?? BA ?? ?? ?? ?? 48 8B ?? E8 ?? ?? ?? ?? 48 8B ?? ?? ?? 48 8B ?? 48 83 C4 ?? 5F C3 CC CC CC CC CC CC CC CC CC CC CC CC 48 89 ?? ?? ?? 57 48 83 EC ?? 48 8B ?? 8B DA 48 83 C1 ?? E8 ?? ?? ?? ?? 48 8D ?? ?? ?? ?? ?? 48 89 ?? F6 C3 ?? 74 ?? BA ?? ?? ?? ?? 48 8B ?? E8 ?? ?? ?? ?? 48 8B ?? ?? ?? 48 8B ?? 48 83 C4 ?? 5F C3 CC CC CC CC CC CC CC CC CC CC CC CC CC CC 48 89 ?? ?? ?? 57 48 83 EC ?? 48 8D");

	this->create_detour(fp, (uint64_t)&hudhook_destructor, &ohuddestfunc);
	if (this->get_detour()->hook()) {
		return true;
	}
	return false;
}

auto hud_destructor::remove() -> bool {
	return this->get_detour()->unHook();
}