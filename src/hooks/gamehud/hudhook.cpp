#include "hudhook.h"
#include <memory.h>

uint64_t ohudfunc;
CGameHudScreen* p_gamehud;
void hudhook_draw(CGameHudScreen* instance, float* deltaFrame) {
	p_gamehud = instance;
	//ilog("IDK: %.3f", *deltaFrame);
	PLH::FnCast(ohudfunc, hudhook_draw)(instance, deltaFrame);
}

auto hudhook::apply() -> bool {
	uintptr_t fp = (uintptr_t)memory::FindSig("48 8B ?? ?? 89 ?? ?? 55 56 57 41 ?? 41 ?? 41 ?? 41 ?? 48 ?? ?? ?? ?? ?? ?? 48 81 ?? ?? ?? ?? ?? ?? 29 ?? ?? ?? 29 ?? ?? ?? 0F ?? ?? ?? ?? 0F ?? ?? ?? ?? 0F ?? ?? ?? ?? ?? ?? 48 8B ?? ?? ?? ?? ?? 48 33 ?? ?? 89 ?? ?? ?? ?? ?? 4C 8B ?? ?? 89 ?? ?? 48");

	this->create_detour(fp, (uint64_t)&hudhook_draw, (uint64_t*)&ohudfunc);
	if (this->get_detour()->hook()) {
		return true;
	}
	return false;
}

auto hudhook::remove() -> bool {
	return this->get_detour()->unHook();
}